{"title":"Zero-Inflated Poisson","markdown":{"yaml":{"title":"Zero-Inflated Poisson"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n```{r, message=F, echo=F}\nlibrary(knitr)\nopts_chunk$set(fig.width = 5, fig.height = 4, fig.align = \"left\", out.width = \"8.5in\")\n\nset.seed(123)\nlibrary(tidyverse)\nlibrary(glmbb) # for crabs data\ndata(crabs, package = \"glmbb\")\n```\n\n\nPoisson regression is used for count and rate data, but if may not be the best model when there are excess zeroes in that data, which is when we may use Zero-inflated poisson regression instead. ZIP models have one parameter representing the probability of a structured zero, and another representing the Poisson mean. The ZIP distribution has the parameters $\\pi$ and $\\lambda$, denoted by $ZIP(\\pi, \\lambda)$, with this probability mass function.\n\n```{=tex}\n\\begin{equation}\n  P(X=k) =\n    \\begin{cases}\n      \\pi + (1-\\pi)(exp(-\\lambda)) & \\text{if $k = 0$}\\\\\n      (1-\\pi)exp(-\\lambda)\\frac{\\lambda^k}{k!} & \\text{if $k = 1, 2, 3, ...$}\\\\\n    \\end{cases}       \n\\end{equation}\n```\nThe figure below shows a zero-inflated Poisson model, where the zeros are either sampling zeros or structural zeros.\n\n```{r echo=F}\nn <- 1000\ncovL <- seq(0, 1, length.out = n)\ncovp <- seq(0, 1, length.out = n)\ntrueMeans <- exp(1 - 0.5 * covL)\nprobability <- plogis(-1.5 + 0.5 * covp)\nU <- runif(n, 0, 1)\ny <- rpois(n, trueMeans)\ny[U < probability] <- 0\nzeroes <- ifelse(U < probability, \"Structural\", \"Sampling\") |> factor(levels = c(\"Structural\", \"Sampling\"))\nsim_data <- data.frame(y, covL, covp, zeroes)\nggplot(sim_data) +\n  geom_bar(aes(x = y, fill = zeroes)) +\n  scale_x_continuous(name = \"Number seen\", breaks = seq(0, 8, 1)) +\n  ggtitle(\"Zero-inflated Poisson model\")\n```\n\n## Uses\n\nAn example of when ZIP-distributed count happens is when ecologists counting plants or animals get a zero when the species is absent at many sites, but get a Poisson distributed count when they are present. Another example is for estimating the the dental health of individuals, by counting how many dental cavities there are. Most people have 0 dental cavities as children, so this is a good use case for ZIP.\n\n## Assumptions\n\n-   It follows the same assumptions for the Poisson regression for the counts generated by the Poisson process, and assumptions that apply for the logistic model that models the probability of being a zero.\n\n## Our Zero-inflated Poisson Regression Implementation\n\n```{r}\nzippoisson_function <- function(fn_formula, data) {\n  number_omitted <- nrow(data) - nrow(na.omit(data))\n  data <- na.omit(data)\n\n  vars <- all.vars(as.formula(fn_formula))\n  y_name <- vars[1]\n  covL <- data[, vars[2]]\n  covp <- data[, vars[3]]\n  n <- nrow(data)\n  Y <- matrix(data[, y_name], nrow = n, ncol = 1)\n\n  optim_zip <- function(beta) {\n    lambda <- exp(beta[1] + beta[2] * covL)\n    p <- plogis(beta[3] + beta[4] * covp)\n    lik <- p * (Y == 0) + (1 - p) * dpois(Y, lambda)\n    return(-sum(log(lik)))\n  }\n  result <- optim(par = rep(0, 4), fn = optim_zip, hessian = T)\n  OI <- solve(result$hessian)\n  se <- sqrt(diag(OI))\n  z_value <- result$par / se\n  p_value <- 2 * pnorm(-1 * abs(z_value))\n\n  coef <- rbind(result$par, se, z_value, p_value)\n\n  colnames(coef) <- c(\"(Intercept)\", vars[2], \"(Intercept)\", vars[3])\n  rownames(coef) <- c(\"Estimate\", \"Std. Error\", \"z value\", \"p value\")\n  return(t(coef))\n}\n```\n\nComparing performance\n\n```{r}\nn <- 1000\ncovL <- seq(0, 1, length.out = n)\ncovp <- seq(0, 1, length.out = n)\ntrueMeans <- exp(1.5 - 0.5 * covL)\nprobability <- plogis(-0.5 + 2.5 * covp)\nU <- runif(n, 0, 1)\ny <- rpois(n, trueMeans)\ny[U < probability] <- 0\nzip_data <- data.frame(y, covL, covp)\nhist(zip_data$y, main = \"Histogram of Zero-inflated Poisson data\", xlab = \"Count\")\n\n# comparing performance of our implementation with zeroinfl\nzippoisson_function(fn_formula = \"y ~ covL | covp\", data = zip_data)\nsummary(pscl::zeroinfl(y ~ covL | covp))$coef\n```\n\n## Checking Assumptions\n\n#### Suitability for ZIP or Poisson\n\nUsing the crabs data again, we will check the suitability for ZIP or Poisson with a likelihood ratio test.\n\n```{r}\nzip_model <- pscl::zeroinfl(satell ~ width | width, data = crabs)\npois_model <- glm(satell ~ width, family = poisson, data = crabs)\nlmtest::lrtest(zip_model, pois_model)\n```\n\nIf we set the significance level at 0.05, the likelihood ratio test shows that we should reject the null hypothesis, so the ZIP model offers an improvement in fit over the Poisson model, since the ZIP model has a log likelihood closer to zero.\n\n```{r}\npois_model <- glm(y ~ covL + covp, data = zip_data)\nzip_model <- pscl::zeroinfl(y ~ covL | covp, data = zip_data)\nlmtest::lrtest(zip_model, pois_model)\n```\n\nThis likelihood ratio test of our own constructed dataset following a ZIP distribution also has a p-value of smaller than 0.05, and that the ZIP model has a log likelihood closer to zero, indicating better suitability for a ZIP model.\n\n## Conclusion\n\nZIP models provide a flexible framework by combining a Poisson distribution for positive counts with a logistic regression component to model the excess zeros. It is most appropriate to plot the data and see whether a dataset containing a count response variable is suited for Poisson or ZIP, and then conducting a likelihood ratio test to compare them.\n","srcMarkdownNoYaml":"\n\n```{r, message=F, echo=F}\nlibrary(knitr)\nopts_chunk$set(fig.width = 5, fig.height = 4, fig.align = \"left\", out.width = \"8.5in\")\n\nset.seed(123)\nlibrary(tidyverse)\nlibrary(glmbb) # for crabs data\ndata(crabs, package = \"glmbb\")\n```\n\n## Introduction\n\nPoisson regression is used for count and rate data, but if may not be the best model when there are excess zeroes in that data, which is when we may use Zero-inflated poisson regression instead. ZIP models have one parameter representing the probability of a structured zero, and another representing the Poisson mean. The ZIP distribution has the parameters $\\pi$ and $\\lambda$, denoted by $ZIP(\\pi, \\lambda)$, with this probability mass function.\n\n```{=tex}\n\\begin{equation}\n  P(X=k) =\n    \\begin{cases}\n      \\pi + (1-\\pi)(exp(-\\lambda)) & \\text{if $k = 0$}\\\\\n      (1-\\pi)exp(-\\lambda)\\frac{\\lambda^k}{k!} & \\text{if $k = 1, 2, 3, ...$}\\\\\n    \\end{cases}       \n\\end{equation}\n```\nThe figure below shows a zero-inflated Poisson model, where the zeros are either sampling zeros or structural zeros.\n\n```{r echo=F}\nn <- 1000\ncovL <- seq(0, 1, length.out = n)\ncovp <- seq(0, 1, length.out = n)\ntrueMeans <- exp(1 - 0.5 * covL)\nprobability <- plogis(-1.5 + 0.5 * covp)\nU <- runif(n, 0, 1)\ny <- rpois(n, trueMeans)\ny[U < probability] <- 0\nzeroes <- ifelse(U < probability, \"Structural\", \"Sampling\") |> factor(levels = c(\"Structural\", \"Sampling\"))\nsim_data <- data.frame(y, covL, covp, zeroes)\nggplot(sim_data) +\n  geom_bar(aes(x = y, fill = zeroes)) +\n  scale_x_continuous(name = \"Number seen\", breaks = seq(0, 8, 1)) +\n  ggtitle(\"Zero-inflated Poisson model\")\n```\n\n## Uses\n\nAn example of when ZIP-distributed count happens is when ecologists counting plants or animals get a zero when the species is absent at many sites, but get a Poisson distributed count when they are present. Another example is for estimating the the dental health of individuals, by counting how many dental cavities there are. Most people have 0 dental cavities as children, so this is a good use case for ZIP.\n\n## Assumptions\n\n-   It follows the same assumptions for the Poisson regression for the counts generated by the Poisson process, and assumptions that apply for the logistic model that models the probability of being a zero.\n\n## Our Zero-inflated Poisson Regression Implementation\n\n```{r}\nzippoisson_function <- function(fn_formula, data) {\n  number_omitted <- nrow(data) - nrow(na.omit(data))\n  data <- na.omit(data)\n\n  vars <- all.vars(as.formula(fn_formula))\n  y_name <- vars[1]\n  covL <- data[, vars[2]]\n  covp <- data[, vars[3]]\n  n <- nrow(data)\n  Y <- matrix(data[, y_name], nrow = n, ncol = 1)\n\n  optim_zip <- function(beta) {\n    lambda <- exp(beta[1] + beta[2] * covL)\n    p <- plogis(beta[3] + beta[4] * covp)\n    lik <- p * (Y == 0) + (1 - p) * dpois(Y, lambda)\n    return(-sum(log(lik)))\n  }\n  result <- optim(par = rep(0, 4), fn = optim_zip, hessian = T)\n  OI <- solve(result$hessian)\n  se <- sqrt(diag(OI))\n  z_value <- result$par / se\n  p_value <- 2 * pnorm(-1 * abs(z_value))\n\n  coef <- rbind(result$par, se, z_value, p_value)\n\n  colnames(coef) <- c(\"(Intercept)\", vars[2], \"(Intercept)\", vars[3])\n  rownames(coef) <- c(\"Estimate\", \"Std. Error\", \"z value\", \"p value\")\n  return(t(coef))\n}\n```\n\nComparing performance\n\n```{r}\nn <- 1000\ncovL <- seq(0, 1, length.out = n)\ncovp <- seq(0, 1, length.out = n)\ntrueMeans <- exp(1.5 - 0.5 * covL)\nprobability <- plogis(-0.5 + 2.5 * covp)\nU <- runif(n, 0, 1)\ny <- rpois(n, trueMeans)\ny[U < probability] <- 0\nzip_data <- data.frame(y, covL, covp)\nhist(zip_data$y, main = \"Histogram of Zero-inflated Poisson data\", xlab = \"Count\")\n\n# comparing performance of our implementation with zeroinfl\nzippoisson_function(fn_formula = \"y ~ covL | covp\", data = zip_data)\nsummary(pscl::zeroinfl(y ~ covL | covp))$coef\n```\n\n## Checking Assumptions\n\n#### Suitability for ZIP or Poisson\n\nUsing the crabs data again, we will check the suitability for ZIP or Poisson with a likelihood ratio test.\n\n```{r}\nzip_model <- pscl::zeroinfl(satell ~ width | width, data = crabs)\npois_model <- glm(satell ~ width, family = poisson, data = crabs)\nlmtest::lrtest(zip_model, pois_model)\n```\n\nIf we set the significance level at 0.05, the likelihood ratio test shows that we should reject the null hypothesis, so the ZIP model offers an improvement in fit over the Poisson model, since the ZIP model has a log likelihood closer to zero.\n\n```{r}\npois_model <- glm(y ~ covL + covp, data = zip_data)\nzip_model <- pscl::zeroinfl(y ~ covL | covp, data = zip_data)\nlmtest::lrtest(zip_model, pois_model)\n```\n\nThis likelihood ratio test of our own constructed dataset following a ZIP distribution also has a p-value of smaller than 0.05, and that the ZIP model has a log likelihood closer to zero, indicating better suitability for a ZIP model.\n\n## Conclusion\n\nZIP models provide a flexible framework by combining a Poisson distribution for positive counts with a logistic regression component to model the excess zeros. It is most appropriate to plot the data and see whether a dataset containing a count response variable is suited for Poisson or ZIP, and then conducting a likelihood ratio test to compare them.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"zipoisson.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"cosmo","title":"Zero-Inflated Poisson"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}